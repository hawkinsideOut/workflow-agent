# Blueprint Creation Guide for AI Agents

> **TL;DR**: Use `PatternStore` API, not manual JSON files. This guide shows you exactly how.

## Quick Start

```typescript
import crypto from "crypto";
import { PatternStore } from "@hawkinside_out/workflow-improvement-tracker";

const store = new PatternStore(process.cwd());
await store.initialize();

const blueprint = {
  id: crypto.randomUUID(),
  name: "Your Blueprint Name",
  description: "What this blueprint creates",
  tags: [{ category: "framework", name: "next" }],
  stack: { /* see full example below */ },
  structure: { directories: [], keyFiles: [] },
  setup: { prerequisites: [], steps: [], configs: [] },
  compatibility: { /* see full example below */ },
  metrics: { successRate: 100, applications: 0, successes: 0, failures: 0 },
  relatedPatterns: [],
  isPrivate: true,
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString()
};

const result = await store.saveBlueprint(blueprint);
console.log(result.success ? `‚úÖ ${result.data.id}` : `‚ùå ${result.error}`);
```

## Why PatternStore?

| Manual JSON | PatternStore API |
|-------------|------------------|
| ‚ùå Must create directories manually | ‚úÖ Auto-creates `.workflow/patterns/blueprints/` |
| ‚ùå Must generate UUID filenames | ‚úÖ Auto-generates `<uuid>.json` |
| ‚ùå No schema validation | ‚úÖ Validates against Zod schema |
| ‚ùå No conflict detection | ‚úÖ Detects duplicate names/content |
| ‚ùå No error messages | ‚úÖ Clear validation errors |

## Common Mistakes

### ‚ùå Wrong Directory
```bash
# DON'T create here:
mkdir -p .workflow/patterns/blueprints
echo '{}' > .workflow/patterns/blueprints/my-blueprint.json
```

### ‚ùå Descriptive Filename
```bash
# DON'T name files like this:
next-app-router-starter.json
nextjs-15-typescript-tailwind.json
```

### ‚ùå Missing Required Fields
```json
{
  "name": "My Blueprint"
  // ‚ùå Missing: id, description, tags, stack, structure, setup, etc.
}
```

## ‚úÖ Correct Approach

```typescript
import crypto from "crypto";
import { PatternStore } from "@hawkinside_out/workflow-improvement-tracker";

const store = new PatternStore(process.cwd());
await store.initialize();

const blueprint = {
  // ============================================
  // REQUIRED: Basic Info
  // ============================================
  id: crypto.randomUUID(),
  name: "Next.js 15 App Router Starter",
  description: "Complete Next.js 15 setup with TypeScript, Tailwind CSS, and ESLint",
  
  // ============================================
  // REQUIRED: Tags (minimum 1)
  // ============================================
  tags: [
    { category: "framework", name: "next" },
    { category: "tool", name: "tailwind" },
    { category: "tool", name: "typescript" }
  ],
  
  // ============================================
  // REQUIRED: Technology Stack
  // ============================================
  stack: {
    framework: "next",
    language: "typescript", // typescript | javascript | python | go | rust | other
    runtime: "node",
    packageManager: "pnpm", // npm | pnpm | yarn | bun
    
    dependencies: [
      { name: "next", version: "15.0.0", compatibleRange: "^15.0.0" },
      { name: "react", version: "19.0.0", compatibleRange: "^19.0.0" },
      { name: "react-dom", version: "19.0.0", compatibleRange: "^19.0.0" }
    ],
    
    devDependencies: [
      { name: "typescript", version: "5.3.3", compatibleRange: "^5.0.0" },
      { name: "@types/react", version: "18.2.45", compatibleRange: "^18.0.0" },
      { name: "@types/node", version: "20.10.5", compatibleRange: "^20.0.0" },
      { name: "tailwindcss", version: "3.4.0", compatibleRange: "^3.4.0" },
      { name: "eslint", version: "8.56.0", compatibleRange: "^8.0.0" }
    ]
  },
  
  // ============================================
  // REQUIRED: Project Structure
  // ============================================
  structure: {
    directories: [
      { path: "app", purpose: "Next.js App Router pages" },
      { path: "app/api", purpose: "API routes" },
      { path: "components", purpose: "Reusable React components" },
      { path: "lib", purpose: "Utility functions and helpers" },
      { path: "public", purpose: "Static assets (images, fonts)" },
      { path: "styles", purpose: "Global styles and Tailwind config" }
    ],
    
    keyFiles: [
      {
        path: "app/layout.tsx",
        purpose: "Root layout with metadata and font setup",
        template: `import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by workflow-agent',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  )
}`
      },
      {
        path: "app/page.tsx",
        purpose: "Home page component",
        template: `export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <div className="z-10 max-w-5xl w-full items-center justify-between font-mono text-sm">
        <h1 className="text-4xl font-bold">Welcome to Next.js 15</h1>
        <p className="mt-4 text-lg">Built with TypeScript and Tailwind CSS</p>
      </div>
    </main>
  )
}`
      },
      {
        path: "app/globals.css",
        purpose: "Global CSS with Tailwind directives",
        template: `@tailwind base;
@tailwind components;
@tailwind utilities;`
      }
    ]
  },
  
  // ============================================
  // REQUIRED: Setup Instructions
  // ============================================
  setup: {
    prerequisites: [
      "Node.js 20.x or later",
      "pnpm 8.x or later"
    ],
    
    steps: [
      {
        order: 1,
        command: "pnpm install",
        description: "Install all dependencies",
        optional: false
      },
      {
        order: 2,
        command: "pnpm run dev",
        description: "Start the development server",
        optional: false
      }
    ],
    
    configs: [
      {
        file: "tsconfig.json",
        description: "TypeScript compiler configuration",
        content: JSON.stringify({
          compilerOptions: {
            target: "ES2020",
            lib: ["ES2020", "DOM", "DOM.Iterable"],
            jsx: "preserve",
            module: "esnext",
            moduleResolution: "bundler",
            resolveJsonModule: true,
            allowJs: true,
            strict: true,
            noEmit: true,
            esModuleInterop: true,
            skipLibCheck: true,
            forceConsistentCasingInFileNames: true,
            incremental: true,
            plugins: [{ name: "next" }],
            paths: {
              "@/*": ["./*"]
            }
          },
          include: ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
          exclude: ["node_modules"]
        }, null, 2)
      },
      {
        file: "tailwind.config.ts",
        description: "Tailwind CSS configuration",
        content: `import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};

export default config;`
      },
      {
        file: ".eslintrc.json",
        description: "ESLint configuration for Next.js",
        content: JSON.stringify({
          extends: ["next/core-web-vitals", "next/typescript"]
        }, null, 2)
      }
    ],
    
    postSetup: ["pnpm run build"]
  },
  
  // ============================================
  // REQUIRED: Compatibility
  // ============================================
  compatibility: {
    framework: "next",
    frameworkVersion: "^15.0.0",
    runtime: "node",
    runtimeVersion: "^20.0.0",
    dependencies: [
      { name: "react", version: "19.0.0", compatibleRange: "^19.0.0" },
      { name: "typescript", version: "5.3.3", compatibleRange: "^5.0.0" }
    ]
  },
  
  // ============================================
  // REQUIRED: Metrics (start at 0)
  // ============================================
  metrics: {
    successRate: 100,
    applications: 0,
    successes: 0,
    failures: 0
  },
  
  // ============================================
  // REQUIRED: Related Patterns (can be empty)
  // ============================================
  relatedPatterns: [],
  
  // ============================================
  // REQUIRED: Privacy (defaults to private)
  // ============================================
  isPrivate: true,
  
  // ============================================
  // REQUIRED: Timestamps
  // ============================================
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString()
};

// Save the blueprint
const result = await store.saveBlueprint(blueprint);

if (result.success) {
  console.log(`‚úÖ Blueprint created successfully!`);
  console.log(`   ID: ${result.data.id}`);
  console.log(`   File: .workflow/patterns/blueprints/${result.data.id}.json`);
  console.log();
  console.log(`To make it syncable, run:`);
  console.log(`   workflow learn:publish ${result.data.id}`);
} else {
  console.error(`‚ùå Failed to create blueprint: ${result.error}`);
}
```

## Verification

After creating a blueprint, verify it appears in the CLI:

```bash
# List all blueprints
workflow learn:list --type blueprint

# Should show:
# üìò Blueprint: Next.js 15 App Router Starter
#    ID: <uuid>
#    Framework: next ^15.0.0
#    Created: 2026-01-20
```

## Making Blueprints Public

By default, blueprints are private (`isPrivate: true`). To share them:

```bash
# Make a specific blueprint public
workflow learn:publish <blueprint-id>

# Or make all patterns public
workflow learn:publish --all --yes
```

## Full Schema Reference

See [patterns-schema.ts](../packages/improvement-tracker/src/patterns-schema.ts) for the complete Zod schema definition.

### Required Blueprint Fields

- ‚úÖ `id`: UUID string
- ‚úÖ `name`: 3-100 characters
- ‚úÖ `description`: max 1000 characters
- ‚úÖ `tags`: Array of `{ category, name }` (minimum 1)
- ‚úÖ `stack`: Object with framework, language, runtime, packageManager, dependencies, devDependencies
- ‚úÖ `structure`: Object with directories array and keyFiles array
- ‚úÖ `setup`: Object with prerequisites, steps, configs arrays
- ‚úÖ `compatibility`: Object with framework, frameworkVersion, dependencies
- ‚úÖ `metrics`: Object with successRate, applications, successes, failures
- ‚úÖ `relatedPatterns`: Array of UUIDs (can be empty)
- ‚úÖ `isPrivate`: Boolean (defaults to true)
- ‚úÖ `createdAt`: ISO 8601 datetime string
- ‚úÖ `updatedAt`: ISO 8601 datetime string

### Valid Enum Values

**Language**: `typescript`, `javascript`, `python`, `go`, `rust`, `other`

**PackageManager**: `npm`, `pnpm`, `yarn`, `bun`

**Tag Category**: `framework`, `tool`, `error-type`, `file-type`, `custom`

## Simpler Alternative

For simple blueprints, use the interactive CLI:

```bash
workflow learn:record \
  --type blueprint \
  --name "Next.js 15 Starter" \
  --description "Complete Next.js 15 setup" \
  --framework next \
  --version "^15.0.0"
```

The CLI handles all schema complexity automatically!

## Related Documentation

- [Agent Learning System](../docs/content/agent-learning.mdx) - Full API documentation
- [Pattern Analysis Workflow](./PATTERN_ANALYSIS_WORKFLOW.md) - Learning system workflow
- [patterns-schema.ts](../packages/improvement-tracker/src/patterns-schema.ts) - Complete schema definitions
