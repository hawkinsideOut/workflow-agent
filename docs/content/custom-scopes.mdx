---
title: Custom Scopes
description: Create and manage custom scope packages for your projects
---

# Custom Scopes

Create reusable scope packages tailored to your project's domain and workflow.

## When to Create Custom Scopes

Consider creating a custom scope package when:

- **Your domain isn't covered** by existing presets (SaaS, Library, API, E-commerce, CMS)
- **You want to reuse scopes** across multiple projects
- **You need domain-specific scopes** (fintech, healthcare, gaming, education, etc.)
- **You're standardizing** workflow across a team or organization

## Quick Start

Create a custom scope package interactively:

```bash
workflow scope:create
```

This command will:
1. Prompt for package name and preset details
2. Guide you through defining scopes
3. Validate all scope definitions
4. Generate a complete package structure
5. Provide next steps for building and publishing

## Interactive CLI Walkthrough

The `scope:create` command guides you through the entire process:

### Step 1: Package Details

```
ğŸ¨ Create Custom Scope Package

âœ“ Detected monorepo workspace

? What is the package name? (e.g., "fintech", "gaming", "healthcare")
> fintech

? What is the preset display name? (e.g., "FinTech Application")
> FinTech Platform
```

### Step 2: Define Scopes

```
Add scopes to your preset (aim for 8-15 scopes):

Scope #1 - Name:
> accounts

Description:
> Account management and user profiles

Emoji (optional):
> ğŸ‘¤

Category (optional):
  1. Authentication & Authorization
  2. Features & Functionality
  3. Infrastructure & DevOps
  ...
> 2

âœ“ Added scope: accounts

You have 1 scope. Add another? (y/n)
> y
```

Continue adding scopes for your project's feature areas.

### Step 3: Review and Create

```
âœ“ 12 scopes validated successfully

Output directory:
> ./packages/scopes-fintech

âœ¨ Custom scope package created successfully!

Package details:
  Location: /path/to/packages/scopes-fintech
  Package: @workflow/scopes-fintech
  Scopes: 12 defined


\`\`\`text
Next steps:
  1. cd packages/scopes-fintech
  2. pnpm install
  3. pnpm build
  4. pnpm test
  5. Update repository URL in package.json
\`\`\`


## Package Structure

Each scope package follows this structure:

```text
scopes-{name}/
â”œâ”€â”€ package.json       # Package metadata and dependencies
â”œâ”€â”€ tsconfig.json      # TypeScript configuration
â”œâ”€â”€ tsup.config.ts     # Build configuration
â””â”€â”€ src/
    â”œâ”€â”€ index.ts       # Scope definitions and preset export
    â””â”€â”€ index.test.ts  # Test suite (generated automatically)
```

### src/index.ts

```typescript
import type { Scope } from '@hawkinside_out/workflow-agent/config';

export const scopes: Scope[] = [
  {
    name: 'accounts',
    description: 'Account management and user profiles',
    emoji: 'ğŸ‘¤',
    category: 'features',
  },
  {
    name: 'payments',
    description: 'Payment processing and transactions',
    emoji: 'ğŸ’³',
    category: 'features',
  },
  // ... more scopes
];

export const preset = {
  name: 'FinTech Platform',
  description: 'Scope configuration for FinTech Platform',
  scopes,
  version: '1.0.0',
};

export default preset;
```

## Scope Schema

Each scope must conform to this schema:

```typescript
interface Scope {
  name: string;              // Required: lowercase, alphanumeric, hyphens
                             // Max length: 32 characters
                             // Cannot be: init, create, build, test, 
                             //            config, docs, ci, deps
  
  description: string;       // Required: min 10 characters
  
  emoji?: string;            // Optional: visual identifier
  
  category?: 'auth' |        // Optional: grouping
             'features' |
             'infrastructure' |
             'documentation' |
             'testing' |
             'performance' |
             'other';
}
```

### Validation Rules

âœ… **Valid scope names:**
- `auth`
- `user-management`
- `api-endpoints`
- `payment-processing`

âŒ **Invalid scope names:**
- `Auth` (uppercase)
- `user_management` (underscores)
- `build` (reserved word)
- `x` (description too short)

## Non-Interactive Mode

For CI/CD or automation:

```bash
workflow scope:create \
  --name fintech \
  --preset-name "FinTech Platform" \
  --scopes "accounts:Account management:ğŸ‘¤:features,payments:Payment processing:ğŸ’³:features,transactions:Transaction history:ğŸ“Š:features"
```

Format: `name:description:emoji:category` (comma-separated)

## Testing Your Scope Package

Every scope package includes a test suite:

```bash
cd packages/scopes-fintech
pnpm install
pnpm test
```

Tests verify:
- âœ… All scopes match the schema
- âœ… No duplicate scope names
- âœ… All descriptions are present
- âœ… Preset structure is valid

### Example Test Output

```
âœ“ src/index.test.ts (5)
  âœ“ FinTech Platform Scope Preset (5)
    âœ“ should export valid scopes array
    âœ“ should have valid preset object
    âœ“ should have no duplicate scope names
    âœ“ should have all scopes match schema
    âœ“ should have descriptions for all scopes

Test Files  1 passed (1)
Tests  5 passed (5)
```

## Publishing to npm

### 1. Update package.json

Before publishing, update:

```json
{
  "name": "@your-org/scopes-fintech",
  "version": "1.0.0",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/your-org/your-repo.git",
    "directory": "packages/scopes-fintech"
  },
  "author": "Your Name"
}
```

### 2. Build and Publish

```bash
# Build the package
pnpm build

# Log in to npm (first time only)
npm login

# Publish
pnpm publish --access public
```

### 3. Use in Other Projects

```bash
# Install the published package
pnpm add @your-org/scopes-fintech

# Reference in workflow.config.json
{
  "projectName": "my-project",
  "preset": "@your-org/scopes-fintech",
  "enforcement": { "level": "strict" }
}
```

## Migrating Existing Scopes

If you already have scopes defined in `workflow.config.json`, migrate them to a package:

```bash
workflow scope:migrate
```

This command will:
1. Load your existing scopes
2. Prompt for package details
3. Create a new package with your scopes
4. Optionally update `workflow.config.json` to reference the package

### Example Migration

**Before** (`workflow.config.json`):

```json
{
  "projectName": "my-app",
  "scopes": [
    { "name": "auth", "description": "Authentication" },
    { "name": "api", "description": "API endpoints" },
    { "name": "ui", "description": "User interface" }
  ]
}
```

**After migration:**

```json
{
  "projectName": "my-app",
  "preset": "scopes-my-app",
  "enforcement": { "level": "strict" }
}
```

Scopes are now in `packages/scopes-my-app/src/index.ts` and can be reused!

## Monorepo Integration

Workflow Agent automatically detects monorepos (checks for `pnpm-workspace.yaml`).

### Automatic Workspace Addition

When creating a scope package in a monorepo:

```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'  # Your new scope package is automatically included
```

If using explicit package listing, you'll be prompted to add:

```yaml
packages:
  - 'packages/scopes-fintech'
```

### Installing in Monorepo

```bash
# From workspace root
pnpm install

# Build the scope package
cd packages/scopes-fintech
pnpm build

# Use in other workspace packages
cd ../my-app
pnpm add -w @workflow/scopes-fintech
```

## Best Practices

### 1. Scope Count

ğŸ¯ **Aim for 8-15 scopes per preset**

- Too few (&lt;5): Not granular enough for tracking
- Too many (&gt;20): Difficult to remember and use consistently
- Sweet spot (8-15): Comprehensive coverage, easy to remember

### 2. Naming Conventions

âœ… **Good:** Domain-specific, clear
- `patient-records`
- `prescription-management`
- `insurance-claims`

âŒ **Avoid:** Generic terms
- `feature`
- `thing`
- `stuff`

### 3. Description Quality

âœ… **Good:** Specific, actionable
- "Patient medical records and history management"
- "Real-time payment processing and transaction handling"

âŒ **Avoid:** Vague descriptions
- "Handles things"
- "Some feature"

### 4. Folder Alignment

Map scopes to your codebase structure:

```
src/
â”œâ”€â”€ auth/          â†’ scope: auth
â”œâ”€â”€ billing/       â†’ scope: billing  
â”œâ”€â”€ analytics/     â†’ scope: analytics
â””â”€â”€ ui/
    â”œâ”€â”€ dashboard/ â†’ scope: dashboard
    â””â”€â”€ reports/   â†’ scope: reports
```

### 5. Category Usage

Use categories for logical grouping:

```typescript
// Authentication & Security
{ category: 'auth' }  // login, signup, mfa, sessions

// Core Features
{ category: 'features' }  // business logic, workflows

// Technical Infrastructure  
{ category: 'infrastructure' }  // deployment, monitoring

// Quality & Testing
{ category: 'testing' }  // unit tests, e2e tests
```

## Automatic Scope Discovery

Workflow Agent automatically discovers and loads custom scope packages:

### Discovery Locations

1. **Workspace packages:** `packages/scopes-*/src/index.{ts,js}`
2. **Node modules:** `node_modules/@*/workflow-scopes-*/dist/index.{js,mjs}`

### Caching

Discovered scopes are cached for 5 minutes to improve performance.

Invalidate cache programmatically:

```typescript
import { invalidateCustomScopesCache } from '@hawkinside_out/workflow-agent/validators';

invalidateCustomScopesCache();
```

## Troubleshooting

### Build Errors

**Problem:** TypeScript errors during build

```bash
# Ensure peer dependencies are installed
pnpm install

# Run type checking
pnpm typecheck
```

### Validation Errors

**Problem:** Scopes fail schema validation

```typescript
import { validateScopeDefinitions } from '@hawkinside_out/workflow-agent/config';

const result = validateScopeDefinitions(scopes);
if (!result.valid) {
  console.error('Validation errors:', result.errors);
}
```

### Import Errors

**Problem:** Cannot import scope package

```bash
# Ensure package is built
cd packages/scopes-fintech
pnpm build

# Check exports in package.json
cat package.json | grep exports
```

## Advanced: Extending Existing Presets

Combine presets with custom scopes:

```typescript
import { scopes as saasScopes } from '@workflow/scopes-saas';
import { scopes as customScopes } from './custom-scopes.js';

export const scopes = [
  ...saasScopes,
  ...customScopes,
  {
    name: 'compliance',
    description: 'Regulatory compliance and audit features',
    category: 'features',
  },
];
```

## Examples

### Healthcare Application

```typescript
export const scopes: Scope[] = [
  { name: 'patients', description: 'Patient records and profiles', emoji: 'ğŸ‘¤' },
  { name: 'appointments', description: 'Scheduling and calendar', emoji: 'ğŸ“…' },
  { name: 'prescriptions', description: 'Prescription management', emoji: 'ğŸ’Š' },
  { name: 'lab-results', description: 'Laboratory test results', emoji: 'ğŸ§ª' },
  { name: 'billing', description: 'Medical billing and insurance', emoji: 'ğŸ’³' },
  { name: 'messaging', description: 'Secure patient messaging', emoji: 'ğŸ’¬' },
  { name: 'reports', description: 'Medical reports and analytics', emoji: 'ğŸ“Š' },
  { name: 'compliance', description: 'HIPAA and regulatory compliance', emoji: 'ğŸ”’' },
];
```

### Gaming Platform

```typescript
export const scopes: Scope[] = [
  { name: 'players', description: 'Player accounts and profiles', emoji: 'ğŸ®' },
  { name: 'matches', description: 'Game matches and sessions', emoji: 'ğŸ†' },
  { name: 'leaderboards', description: 'Rankings and leaderboards', emoji: 'ğŸ“Š' },
  { name: 'inventory', description: 'In-game items and inventory', emoji: 'ğŸ’' },
  { name: 'marketplace', description: 'Item trading and marketplace', emoji: 'ğŸª' },
  { name: 'chat', description: 'Player communication and chat', emoji: 'ğŸ’¬' },
  { name: 'guilds', description: 'Clans and guild management', emoji: 'âš”ï¸' },
  { name: 'events', description: 'Tournaments and special events', emoji: 'ğŸ¯' },
];
```

## Next Steps

- âœ… **[View existing presets](/docs/presets)** to see if one fits your needs
- âœ… **[Learn about configuration](/docs/configuration)** to customize enforcement
- âœ… **[Create your first scope package](#quick-start)** with `workflow scope:create`
- âœ… **[Migrate existing scopes](#migrating-existing-scopes)** with `workflow scope:migrate`

---

**Need help?** Check the [template reference](/templates/CUSTOM_SCOPE_TEMPLATE.md) or [workflow guide](/templates/SCOPE_CREATION_WORKFLOW.md) for detailed examples.