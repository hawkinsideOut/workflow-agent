# Agent Learning System

> The Agent Learning System enables workflow-agent to learn from successful implementations across your projects, building a knowledge base of proven patterns that can be shared with the community.

---

## Overview

The Agent Learning System captures successful fixes and project blueprints as reusable patterns. When you fix a linting error, resolve a type issue, or configure a new project successfully, the agent can record these solutions for future use.

### Key Features

- **Pattern Recording**: Capture successful fixes and project setups
- **Local-First Storage**: All patterns stored locally in `.workflow/patterns/`
- **Opt-In Sync**: Share anonymized patterns with the community
- **Privacy Protection**: PII automatically stripped before sharing
- **Telemetry**: Track pattern success rates for quality improvement
- **Auto-Deprecation**: Patterns unused for 1+ year are automatically deprecated

---

## How It Works

### 1. Pattern Detection

When you run `workflow verify --fix --learn`, the agent:

1. Executes quality checks (typecheck, lint, format, test, build)
2. Applies auto-fixes when issues are found
3. Re-validates to ensure fixes work
4. Records successful fixes as patterns

```bash
# Run verification with learning enabled
workflow verify --fix --learn

# Example output
âœ… ALL QUALITY CHECKS PASSED!
  Total time: 12.5s
  Validation cycles: 3
  Fixes applied: 2

ğŸ“š Recording successful fixes for learning...
  âœ“ Recorded: Auto-fix: ESLint
  âœ“ Recorded: Auto-fix: Prettier

Use 'workflow learn:list' to see recorded patterns.
```

### 2. Pattern Storage

Patterns are stored in two categories:

| Type | Description | Use Case |
|------|-------------|----------|
| **Fix Patterns** | Single-issue solutions | Lint errors, type errors, config issues |
| **Blueprints** | Complete project setups | Next.js starter, Express API template |

Storage location: `.workflow/patterns/`

```
.workflow/
â”œâ”€â”€ patterns/
â”‚   â”œâ”€â”€ fixes/
â”‚   â”‚   â”œâ”€â”€ <uuid>.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ blueprints/
â”‚       â”œâ”€â”€ <uuid>.json
â”‚       â””â”€â”€ ...
â””â”€â”€ .contributor-id
```

### 3. Pattern Application

When similar errors occur, the agent suggests relevant patterns:

```bash
# List available patterns
workflow learn:list

# Apply a specific pattern
workflow learn:apply <pattern-id>
```

---

## CLI Commands

### `workflow learn:record`

Manually record a new pattern:

```bash
# Record a fix pattern
workflow learn:record \
  --type fix \
  --name "ESLint no-unused-vars" \
  --description "Add underscore prefix to unused variables" \
  --category lint \
  --framework react \
  --version "^18.0.0"

# Record a blueprint
workflow learn:record \
  --type blueprint \
  --name "Next.js 14 Starter" \
  --description "Complete Next.js setup with TypeScript, Tailwind, and testing" \
  --framework next \
  --version "^14.0.0"
```

**Options:**
- `--type` - Pattern type: `fix` or `blueprint`
- `--name` - Human-readable name (3-100 characters)
- `--description` - What the pattern does (max 500 characters)
- `--category` - Fix category: `lint`, `type-error`, `dependency`, `config`, `runtime`, `build`, `test`, `security`
- `--framework` - Target framework: `next`, `react`, `vue`, `express`, etc.
- `--version` - Semver-compatible version range
- `--tags` - Comma-separated tags: `framework:react,tool:eslint`

### `workflow learn:list`

View recorded patterns:

```bash
# List all patterns
workflow learn:list

# Filter by type
workflow learn:list --type fix

# Filter by framework
workflow learn:list --framework next

# Include deprecated patterns
workflow learn:list --deprecated
```

### `workflow learn:apply`

Apply a pattern to the current project:

```bash
# Apply by pattern ID
workflow learn:apply abc123-def456

# Dry run to preview changes
workflow learn:apply abc123-def456 --dry-run
```

### `workflow learn:stats`

View learning statistics:

```bash
workflow learn:stats

# Output
ğŸ“Š Pattern Statistics

Total Patterns: 45
  Fix Patterns: 38
  Blueprints: 7

Success Metrics:
  Overall Success Rate: 87.3%
  Most Applied: "ESLint unused-vars fix" (127 applications)

Storage:
  Private Patterns: 40
  Synced Patterns: 5
  Deprecated: 3
```

### `workflow learn:config`

Configure learning settings:

```bash
# View current configuration
workflow learn:config

# Enable telemetry (anonymous usage data)
workflow learn:config --enable-telemetry

# Disable telemetry
workflow learn:config --disable-telemetry

# Enable community sync
workflow learn:config --enable-sync

# Disable community sync
workflow learn:config --disable-sync
```

### `workflow learn:deprecate`

Deprecate a pattern:

```bash
# Deprecate with reason
workflow learn:deprecate <pattern-id> --reason "Superseded by better solution"
```

### `workflow learn:publish`

Mark patterns as public (syncable) or private:

```bash
# Mark a single pattern as public
workflow learn:publish <pattern-id>

# Mark a single pattern as private
workflow learn:publish <pattern-id> --private

# Mark all patterns as public
workflow learn:publish --all

# Mark all patterns as private
workflow learn:publish --all --private

# Skip confirmation prompts (for CI/automation)
workflow learn:publish --all --yes
```

### `workflow learn:sync`

Sync patterns with the community registry:

```bash
# Preview what would be synced
workflow learn:sync --dry-run

# Push local patterns to registry
workflow learn:sync --push

# Pull new patterns from registry
workflow learn:sync --pull
```

---

## Pattern Schema

### Fix Pattern Structure

```typescript
interface FixPattern {
  id: string;           // UUID
  name: string;         // "ESLint no-unused-vars fix"
  description: string;  // What this pattern fixes
  category: string;     // lint, type-error, dependency, etc.
  
  tags: Array<{
    name: string;       // "eslint"
    category: string;   // framework, tool, error-type, file-type, custom
  }>;
  
  trigger: {
    errorPattern: string;   // Regex to match error messages
    errorMessage?: string;  // Example error (anonymized)
    filePattern?: string;   // Glob pattern: "*.tsx"
  };
  
  solution: {
    type: string;   // command, file-change, config-update, etc.
    steps: Array<{
      order: number;
      action: string;       // run, create, modify, delete, install
      target: string;       // Command or file path
      description: string;
    }>;
  };
  
  compatibility: {
    framework: string;        // "next"
    frameworkVersion: string; // "^14.0.0"
    runtime?: string;         // "node"
    runtimeVersion?: string;  // ">=18.0.0"
    dependencies: Array<{
      name: string;
      version: string;
      compatibleRange: string;
    }>;
  };
  
  metrics: {
    successRate: number;    // 0-100
    applications: number;   // Total uses
    successes: number;
    failures: number;
    lastUsed?: string;      // ISO datetime
  };
  
  source: string;     // manual, auto-heal, verify-fix, imported, community
  isPrivate: boolean; // Default: true
  createdAt: string;
  updatedAt: string;
}
```

### Blueprint Structure

```typescript
interface Blueprint {
  id: string;
  name: string;           // "Next.js 14 TypeScript Starter"
  description: string;
  
  tags: PatternTag[];
  
  stack: {
    framework: string;      // "next"
    language: string;       // typescript, javascript, python, etc.
    runtime: string;        // "node"
    packageManager: string; // npm, pnpm, yarn, bun
    dependencies: DependencyVersion[];
    devDependencies: DependencyVersion[];
  };
  
  structure: {
    directories: Array<{ path: string; purpose: string }>;
    keyFiles: Array<{ path: string; purpose: string; template?: string }>;
  };
  
  setup: {
    prerequisites: string[];
    steps: Array<{
      order: number;
      command: string;
      description: string;
      optional: boolean;
    }>;
    configs: Array<{
      file: string;
      content: string;
      description: string;
    }>;
  };
  
  compatibility: Compatibility;
  metrics: PatternMetrics;
  relatedPatterns: string[]; // UUIDs of related fix patterns
  
  isPrivate: boolean;
  createdAt: string;
  updatedAt: string;
}
```

---

## Privacy & Security

### What Gets Anonymized

Before any pattern is shared, the following is stripped:

| Data Type | Example | Replacement |
|-----------|---------|-------------|
| File paths | `/home/user/project/src` | `<PATH>/src` |
| Email addresses | `dev@company.com` | `<EMAIL>` |
| IP addresses | `192.168.1.100` | `<IP>` |
| API keys | `sk_live_abc123...` | `<API_KEY>` |
| Secrets/tokens | `ghp_xxxxx` | `<SECRET>` |
| URLs with auth | `https://user:pass@host` | `<URL>` |

### Contributor ID

Each installation generates an anonymous contributor ID:

```
wf-550e8400-e29b-41d4-a716-446655440000
```

This ID:
- Contains no personally identifiable information
- Is stored locally in `.workflow/.contributor-id`
- Can be reset anytime with `workflow learn:config --reset-id`
- Is used only for pattern attribution, not tracking

### Telemetry

When telemetry is enabled, the following is collected:

- Pattern ID applied
- Success/failure outcome
- Framework and version used
- Anonymized failure reason (if applicable)

**No** source code, file contents, or personal data is ever transmitted.

```bash
# Check telemetry status
workflow learn:config

# Disable telemetry
workflow learn:config --disable-telemetry
```

---

## Configuration

### Enable Learning on Verify

Add to your npm scripts:

```json
{
  "scripts": {
    "verify": "workflow verify --fix --learn"
  }
}
```

### workflow.config.json

```json
{
  "learning": {
    "autoRecord": true,
    "telemetry": false,
    "syncEnabled": false,
    "syncRegistry": "https://patterns.workflow-agent.dev"
  }
}
```

### Environment Variables

```bash
# Disable learning globally
WORKFLOW_LEARNING_DISABLED=true

# Custom patterns directory
WORKFLOW_PATTERNS_DIR=.custom-patterns
```

---

## Conflict Resolution

When importing patterns that conflict with existing ones:

### Detection

Conflicts are detected by:
1. Same pattern name
2. Same content hash (identical trigger + solution)

### Resolution

```bash
# During sync, conflicts are versioned
workflow learn:sync --pull

# Patterns are saved as:
# - original-pattern.json (conflictVersion: 1)
# - original-pattern-v2.json (conflictVersion: 2)
```

Each version includes `originalId` reference for traceability.

---

## Auto-Deprecation

Patterns are automatically deprecated when:

1. Not updated in 365+ days
2. Success rate drops below 20% (after 10+ applications)
3. Manually marked deprecated

Deprecated patterns:
- Still available via `--deprecated` flag
- Not synced to community registry
- Not suggested automatically

---

## Best Practices

### Recording Good Patterns

1. **Be specific**: Name patterns clearly (`"ESLint prefer-const rule"` not `"lint fix"`)
2. **Document well**: Include what, why, and when to use
3. **Test first**: Only record patterns that actually work
4. **Tag appropriately**: Use relevant tags for discoverability

### Organizing Patterns

```bash
# Use tags for organization
workflow learn:record \
  --tags "framework:next,tool:eslint,error-type:unused-import"
```

### Sharing Patterns

1. Enable sync: `workflow learn:config --enable-sync`
2. Mark patterns public: `workflow learn:publish <pattern-id>` or `workflow learn:publish --all`
3. Push to registry: `workflow learn:sync --push`

---

## Programmatic API

Use the learning system in your own tools:

```typescript
import {
  PatternStore,
  ContributorManager,
  TelemetryCollector,
  PatternAnonymizer,
  type FixPattern,
} from "@hawkinside_out/workflow-improvement-tracker";

// Initialize
const store = new PatternStore(process.cwd());
await store.initialize();

// Save a pattern
const pattern: FixPattern = { /* ... */ };
await store.saveFixPattern(pattern);

// Find matching patterns
const matches = await store.findMatchingFixes(
  "Cannot find module 'lodash'",
  "next"
);

// Update metrics after use
await store.updateFixMetrics(patternId, true); // success

// Anonymize before sharing
const anonymizer = new PatternAnonymizer();
const { data: anonymized } = anonymizer.anonymizeFixPattern(pattern);

// Record telemetry
const telemetry = new TelemetryCollector(process.cwd());
await telemetry.recordSuccess(patternId, "fix", "next", "14.0.0");
```

---

## For AI Agents: Creating Blueprints Programmatically

> **Important**: AI agents should use the `workflow learn:record` CLI command, not manually create JSON files. However, if you need to create blueprints programmatically, follow this guide precisely.

### Common Mistakes

âŒ **Don't do this:**
- Create files in `.workflow/patterns/` (wrong directory)
- Use descriptive filenames like `next-app-router.json`
- Skip required schema fields
- Manually construct the schema

âœ… **Do this instead:**

```typescript
import crypto from "crypto";
import { PatternStore } from "@hawkinside_out/workflow-improvement-tracker";

// Use the PatternStore API
const store = new PatternStore(process.cwd());
await store.initialize();

// Create blueprint with all required fields
const blueprint = {
  // Required identifiers
  id: crypto.randomUUID(),
  name: "Next.js 15 App Router Starter",
  description: "Complete Next.js 15 setup with TypeScript, Tailwind CSS, and ESLint",
  
  // Required tags array (at least one framework tag)
  tags: [
    { category: "framework", name: "next" },
    { category: "tool", name: "tailwind" },
    { category: "tool", name: "eslint" }
  ],
  
  // Required stack object
  stack: {
    framework: "next",
    language: "typescript",
    runtime: "node",
    packageManager: "pnpm",
    dependencies: [
      {
        name: "next",
        version: "15.0.0",
        compatibleRange: "^15.0.0"
      },
      {
        name: "react",
        version: "19.0.0",
        compatibleRange: "^19.0.0"
      },
      {
        name: "react-dom",
        version: "19.0.0",
        compatibleRange: "^19.0.0"
      }
    ],
    devDependencies: [
      {
        name: "typescript",
        version: "5.3.3",
        compatibleRange: "^5.0.0"
      },
      {
        name: "@types/react",
        version: "18.2.45",
        compatibleRange: "^18.0.0"
      },
      {
        name: "@types/node",
        version: "20.10.5",
        compatibleRange: "^20.0.0"
      },
      {
        name: "tailwindcss",
        version: "3.4.0",
        compatibleRange: "^3.4.0"
      },
      {
        name: "eslint",
        version: "8.56.0",
        compatibleRange: "^8.0.0"
      }
    ]
  },
  
  // Required structure object
  structure: {
    directories: [
      { path: "app", purpose: "Next.js App Router pages" },
      { path: "app/api", purpose: "API routes" },
      { path: "components", purpose: "Reusable React components" },
      { path: "lib", purpose: "Utility functions" },
      { path: "public", purpose: "Static assets" }
    ],
    keyFiles: [
      {
        path: "app/layout.tsx",
        purpose: "Root layout component",
        template: `import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'App',
  description: 'Generated with workflow-agent',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  )
}`
      },
      {
        path: "app/page.tsx",
        purpose: "Home page",
        template: `export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <h1 className="text-4xl font-bold">Welcome</h1>
    </main>
  )
}`
      },
      {
        path: "tailwind.config.ts",
        purpose: "Tailwind CSS configuration"
      }
    ]
  },
  
  // Required setup object
  setup: {
    prerequisites: ["Node.js 20+", "pnpm installed"],
    steps: [
      {
        order: 1,
        command: "pnpm install",
        description: "Install dependencies",
        optional: false
      },
      {
        order: 2,
        command: "pnpm run dev",
        description: "Start development server",
        optional: false
      }
    ],
    configs: [
      {
        file: "tsconfig.json",
        description: "TypeScript configuration",
        content: JSON.stringify({
          compilerOptions: {
            target: "ES2020",
            lib: ["ES2020", "DOM", "DOM.Iterable"],
            jsx: "preserve",
            module: "esnext",
            moduleResolution: "bundler",
            strict: true,
            esModuleInterop: true,
            skipLibCheck: true,
            forceConsistentCasingInFileNames: true
          },
          include: ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
          exclude: ["node_modules"]
        }, null, 2)
      }
    ],
    postSetup: ["pnpm run build"]
  },
  
  // Required compatibility object
  compatibility: {
    framework: "next",
    frameworkVersion: "^15.0.0",
    runtime: "node",
    runtimeVersion: "^20.0.0",
    dependencies: [
      { name: "react", version: "19.0.0", compatibleRange: "^19.0.0" }
    ]
  },
  
  // Required metrics object
  metrics: {
    successRate: 100,
    applications: 0,
    successes: 0,
    failures: 0
  },
  
  // Required arrays (can be empty)
  relatedPatterns: [],
  
  // Privacy flags (defaults to private)
  isPrivate: true,
  
  // Required timestamps
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString()
};

// Save using PatternStore (validates schema automatically)
const result = await store.saveBlueprint(blueprint);

if (result.success) {
  console.log(`âœ… Blueprint created: ${result.data.id}`);
  console.log(`ğŸ“ Saved to: .workflow/patterns/blueprints/${result.data.id}.json`);
} else {
  console.error(`âŒ Failed: ${result.error}`);
}
```

### Key Points

1. **Always use `PatternStore`** - It handles:
   - Schema validation
   - Directory creation (`.workflow/patterns/blueprints/`)
   - UUID-based filenames
   - Conflict detection

2. **Required fields** - All blueprints must have:
   - `id` (UUID)
   - `name`, `description`
   - `tags` array with at least one tag
   - `stack` object (framework, language, runtime, dependencies)
   - `structure` object (directories, keyFiles arrays)
   - `setup` object (prerequisites, steps, configs arrays)
   - `compatibility` object
   - `metrics` object
   - `relatedPatterns` array (can be empty)
   - `createdAt`, `updatedAt` timestamps

3. **Storage location**: `.workflow/patterns/blueprints/<uuid>.json`

4. **Make patterns public** after creating:
   ```bash
   workflow learn:publish --all --yes
   ```

### Simpler Alternative: Use the CLI

Instead of manual creation, prefer the interactive CLI:

```bash
workflow learn:record \
  --type blueprint \
  --name "Next.js 15 App Router" \
  --description "Complete Next.js 15 setup" \
  --framework next \
  --version "^15.0.0"
```

The CLI handles all the schema complexity for you!

---

## Troubleshooting

### "Patterns not recognized by CLI"

**Symptom**: Manually created blueprint JSON files in `.workflow/patterns/blueprints/` not showing up in `workflow learn:list`.

**Common causes**:
1. **Schema validation failure** - Blueprint doesn't match required schema
2. **Missing required fields** - Check all required fields above
3. **Invalid JSON** - Syntax error in the JSON file
4. **Wrong filename format** - Must be `<uuid>.json` (e.g., `550e8400-e29b-41d4-a716-446655440000.json`)

**Solution**:
```bash
# Verify schema with Node.js
node -e "
const { PatternStore } = require('@hawkinside_out/workflow-improvement-tracker');
const fs = require('fs');

const blueprint = JSON.parse(fs.readFileSync('.workflow/patterns/blueprints/<your-file>.json', 'utf-8'));
const store = new PatternStore(process.cwd());

store.saveBlueprint(blueprint).then(result => {
  if (result.success) {
    console.log('âœ… Valid blueprint');
  } else {
    console.error('âŒ Invalid:', result.error);
  }
});
"

# Or use the API to create properly:
# See "For AI Agents: Creating Blueprints Programmatically" section above
```

### Patterns not recording

```bash
# Check if learning is enabled
workflow learn:config

# Ensure verify is run with --learn flag
workflow verify --fix --learn
```

### Sync failing

```bash
# Check sync status
workflow learn:config

# Verify patterns are public
workflow learn:list | grep "private: false"
```

### Pattern not matching

Check the trigger regex:

```bash
# View pattern details
cat .workflow/patterns/fixes/<pattern-id>.json | jq '.trigger'
```

---

## Solution Patterns

> **New in v2.4** - Learn from complete, working implementations across your projects.

While Fix Patterns capture single-issue solutions and Blueprints define project templates, **Solution Patterns** capture the **actual working code** from your implementations. When you ask "How do I implement user authentication?", the agent can show you real code from projects where you've already solved that problem.

### What Makes Solutions Different?

| Aspect | Fix Patterns | Blueprints | Solution Patterns |
|--------|-------------|------------|-------------------|
| Scope | Single error | Project setup | Complete feature |
| Content | Steps to fix | Directory structure | Actual source code |
| Use case | "Fix this error" | "Start new project" | "How do I implement X?" |
| Learning | Auto-detected | Manual capture | Code analysis |

### Solution Pattern Structure

```typescript
interface SolutionPattern {
  id: string;
  name: string;                    // "JWT Authentication with Refresh Tokens"
  description: string;             // Detailed explanation
  category: SolutionCategory;      // auth, api, database, ui, etc.
  
  problem: {
    keywords: string[];            // ["authentication", "jwt", "login"]
    description: string;           // What problem this solves
    errorPatterns?: string[];      // Common errors this prevents
  };
  
  implementation: {
    files: SolutionFile[];         // Actual code files
    dependencies: Dependency[];    // Required packages
    devDependencies: Dependency[]; // Dev packages
    envVars: EnvVar[];             // Required environment variables
  };
  
  architecture: {
    entryPoints: string[];         // Where to start reading
    dataFlow: string;              // How data moves through the system
    keyDecisions: string[];        // Architectural choices made
  };
  
  compatibility: {
    framework: string;             // "next", "express", etc.
    frameworkVersion: string;      // "^14.0.0"
  };
  
  metrics: {
    applications: number;          // Times applied
    successRate: number;           // Effectiveness score
  };
}
```

---

## Step-by-Step: Using Solution Patterns

### Step 1: Capture a Working Solution

After you've successfully implemented a feature, capture it as a reusable pattern:

```bash
# Navigate to your project
cd my-project

# Capture the auth implementation
workflow-agent solution:capture \
  --path ./src/auth \
  --name "JWT Authentication" \
  --category auth \
  --tags "jwt,authentication,security"
```

**What happens:**

1. **File Analysis** - The CodeAnalyzer scans all files in `./src/auth`
2. **Dependency Detection** - Extracts `jsonwebtoken`, `bcrypt`, etc. from imports
3. **Environment Variables** - Finds `JWT_SECRET`, `REFRESH_TOKEN_SECRET`, etc.
4. **Architecture Detection** - Identifies patterns like middleware, services, etc.
5. **Pattern Creation** - Stores the complete solution in `.workflow/patterns/solutions/`

**Interactive Mode:**

```bash
workflow-agent solution:capture

# Prompts:
# ? Path to the solution directory: ./src/auth
# ? Solution name: JWT Authentication
# ? Solution description: Complete JWT auth with access and refresh tokens
# ? Solution category: ğŸ” Authentication
# ? Keywords (comma-separated): jwt, authentication, login, refresh-token

# Output:
# âœ“ Solution analyzed
# 
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Name: JWT Authentication
# Category: ğŸ” auth
# Files: 4
# Dependencies: 3
# Framework: next
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 
# ? Save this solution pattern? Yes
# âœ“ Solution saved with ID: 550e8400-e29b-41d4-a716-446655440001
```

---

### Step 2: Search for Solutions

When starting a new feature, search your pattern library:

```bash
# Search by keywords
workflow-agent solution:search "authentication jwt"

# Output:
# ğŸ” Search Solution Patterns
# 
# Found 2 solution(s):
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# JWT Authentication (550e8400)
#   ğŸ” auth
#   Complete JWT auth with access and refresh tokens
#   Files: 4 | Framework: next | Uses: 12
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# OAuth2 Google Login (660e8400)
#   ğŸ” auth
#   Google OAuth2 integration with session management
#   Files: 3 | Framework: next | Uses: 5
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 
# Use 'workflow solution:apply <id>' to apply a solution.
```

**Filter by category or framework:**

```bash
# Only auth patterns
workflow-agent solution:search "login" --category auth

# Only Next.js patterns
workflow-agent solution:search "api routes" --framework next

# Limit results
workflow-agent solution:search "database" --limit 5
```

---

### Step 3: View Your Pattern Library

List all captured solutions:

```bash
workflow-agent solution:list

# Output:
# ğŸ“‹ Solution Patterns
# 
# 8 solution(s):
# 
# ğŸ” auth
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   550e8400 JWT Authentication
#     Complete JWT auth with access and refresh tokens
#     Created: Jan 15, 2026 | Files: 4
#   660e8400 OAuth2 Google Login
#     Google OAuth2 integration with session management
#     Created: Jan 10, 2026 | Files: 3
# 
# ğŸ’¾ database
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   770e8400 Prisma Repository Pattern
#     Type-safe database access with repository pattern
#     Created: Dec 20, 2025 | Files: 6
# 
# ğŸŒ api
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   880e8400 REST API with Validation
#     Express API with Zod validation and error handling
#     Created: Nov 15, 2025 | Files: 5
```

**Filter options:**

```bash
# Filter by category
workflow-agent solution:list --category database

# Include deprecated patterns
workflow-agent solution:list --deprecated

# Limit output
workflow-agent solution:list --limit 10
```

---

### Step 4: Apply a Solution

Apply a captured pattern to your current project:

```bash
workflow-agent solution:apply 550e8400

# Output:
# ğŸš€ Apply Solution Pattern
# 
# Solution: JWT Authentication
# Complete JWT auth with access and refresh tokens
# 
# Files to create:
#   â€¢ src/auth/jwt.service.ts (service)
#   â€¢ src/auth/middleware.ts (middleware)
#   â€¢ src/auth/types.ts (type)
#   â€¢ src/auth/index.ts (entry)
# 
# Dependencies to install:
#   â€¢ jsonwebtoken@9.0.0
#   â€¢ bcrypt@5.1.0
# 
# Environment variables needed:
#   â€¢ JWT_SECRET*
#   â€¢ JWT_REFRESH_SECRET*
#   â€¢ JWT_EXPIRY
# 
# ? Apply this solution? Yes
# 
# âœ“ Solution applied successfully!
# Created 4 file(s).
# 
# Next step: Install dependencies with:
#   npm install jsonwebtoken@9.0.0 bcrypt@5.1.0
```

**Apply options:**

```bash
# Preview without making changes
workflow-agent solution:apply 550e8400 --dry-run

# Include test files
workflow-agent solution:apply 550e8400 --include-tests

# Specify output directory
workflow-agent solution:apply 550e8400 --output ./src/features/auth
```

---

### Step 5: View Statistics

See insights about your pattern library:

```bash
workflow-agent solution:stats

# Output:
# ğŸ“Š Solution Pattern Statistics
# 
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Solutions: 15
#   Active: 12
#   Deprecated: 3
#   Private: 10
#   Synced: 5
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Fixes: 38
# Blueprints: 7
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 
# By Category:
#   ğŸ” auth: 4
#   ğŸ’¾ database: 3
#   ğŸŒ api: 3
#   ğŸ¨ ui: 2
#   ğŸ§ª testing: 2
#   ğŸ“¦ other: 1
```

---

### Step 6: Deprecate Outdated Solutions

Mark a pattern as deprecated when it's superseded:

```bash
workflow-agent solution:deprecate 550e8400 "Replaced by OAuth2 implementation"

# Output:
# âš ï¸  Deprecate Solution Pattern
# 
# Solution: JWT Authentication
# Reason: Replaced by OAuth2 implementation
# 
# ? Deprecate this solution? Yes
# 
# âœ“ Solution deprecated.
```

Deprecated solutions:
- Are hidden from `solution:list` by default
- Show a warning when applied
- Won't be synced to community registry

---

## Solution Categories

| Category | Icon | Use Case |
|----------|------|----------|
| `auth` | ğŸ” | Authentication, authorization, session management |
| `api` | ğŸŒ | API endpoints, REST/GraphQL, routing |
| `database` | ğŸ’¾ | Database schemas, queries, migrations |
| `ui` | ğŸ¨ | Components, layouts, styling |
| `testing` | ğŸ§ª | Test utilities, fixtures, mocks |
| `deployment` | ğŸš€ | CI/CD, Docker, infrastructure |
| `integrations` | ğŸ”— | Third-party services, webhooks |
| `performance` | âš¡ | Caching, optimization, lazy loading |
| `security` | ğŸ›¡ï¸ | Encryption, validation, sanitization |
| `state` | ğŸ”„ | State management, data flow |
| `forms` | ğŸ“ | Form handling, validation |
| `error-handling` | âš ï¸ | Error boundaries, logging |
| `caching` | ğŸ’¨ | Cache strategies, memoization |
| `other` | ğŸ“¦ | Miscellaneous patterns |

---

## CodeAnalyzer: How It Works

The CodeAnalyzer powers the `solution:capture` command:

### File Analysis

For each file, it extracts:

```typescript
interface FileAnalysis {
  path: string;              // "src/auth/jwt.service.ts"
  role: FileRole;            // "service", "middleware", "component", etc.
  purpose: string;           // Auto-generated description
  exports: string[];         // ["generateToken", "verifyToken"]
  imports: string[];         // ["jsonwebtoken", "./config"]
  dependencies: string[];    // External packages only
  lineCount: number;
  content: string;           // Anonymized source code
}
```

### Architecture Detection

The analyzer identifies architectural patterns:

```typescript
// Detected patterns
"Request -> Middleware -> Handler -> Response"  // API with middleware
"Controller -> Service -> Model -> Database"    // Layered architecture
"Component -> Hook -> State -> Render"          // React component pattern
```

### Key Decisions Extraction

Based on dependencies and patterns:

```typescript
// Automatically detected
[
  "Uses Next.js framework",
  "TypeScript for type safety",
  "Prisma ORM for database access",
  "Zod for runtime validation"
]
```

---

## Programmatic API

Use Solution Patterns in your own tools:

```typescript
import {
  PatternStore,
  CodeAnalyzer,
  createCodeAnalyzer,
  type SolutionPattern,
  type SolutionCategory,
} from "@hawkinside_out/workflow-improvement-tracker";

// Initialize store
const store = new PatternStore(process.cwd());

// Create analyzer
const analyzer = createCodeAnalyzer({
  maxFiles: 50,
  extensions: [".ts", ".tsx"],
  ignoreDirs: ["node_modules", "dist"],
  anonymize: true,  // Strip PII
});

// Analyze a directory
const analysis = await analyzer.analyzeDirectory("./src/auth");
console.log(analysis.files);        // Analyzed files
console.log(analysis.dependencies); // Detected dependencies
console.log(analysis.envVars);      // Environment variables

// Detect architecture
const architecture = analyzer.detectArchitecture(analysis);
console.log(architecture.dataFlow);      // "Request -> Middleware -> ..."
console.log(architecture.keyDecisions);  // ["Uses Zod", "TypeScript", ...]

// Create a solution pattern
const pattern = await analyzer.createSolutionPattern(
  "./src/auth",
  "JWT Authentication",
  "Complete JWT auth with refresh tokens",
  "auth" as SolutionCategory,
  ["jwt", "authentication", "login"]
);

// Save the pattern
await store.saveSolution(pattern);

// Search for solutions
const results = await store.searchSolutions(
  ["authentication", "jwt"],
  { category: "auth", limit: 10 }
);

// Get a specific solution
const solution = await store.getSolution("550e8400-...");

// Update metrics after applying
await store.updateSolutionMetrics(solution.data.id, true); // success

// Get statistics
const stats = await store.getStats();
console.log(stats.totalSolutions);
console.log(stats.deprecatedSolutions);
```

---

## Real-World Example: Full Workflow

### Scenario: Building an E-commerce Checkout

You've just finished implementing a checkout flow in your main project. Here's how to capture and reuse it:

#### 1. Capture the Implementation

```bash
cd my-ecommerce-app

workflow-agent solution:capture \
  --path ./src/checkout \
  --name "Stripe Checkout Flow" \
  --category integrations \
  --tags "stripe,payments,checkout,e-commerce"

# âœ“ Solution analyzed
# Files: 6
# Dependencies: @stripe/stripe-js, stripe
# Env vars: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET
# âœ“ Solution saved: abc123
```

#### 2. Start a New Project

```bash
mkdir new-ecommerce && cd new-ecommerce
workflow-agent init --preset saas
```

#### 3. Search for Your Checkout Solution

```bash
workflow-agent solution:search "stripe checkout payments"

# Found 1 solution(s):
# Stripe Checkout Flow (abc123)
#   ğŸ”— integrations
#   Complete Stripe checkout with webhooks
```

#### 4. Apply the Solution

```bash
workflow-agent solution:apply abc123

# Files to create:
#   â€¢ src/checkout/stripe.service.ts
#   â€¢ src/checkout/webhook.handler.ts
#   â€¢ src/checkout/types.ts
#   â€¢ src/api/checkout/route.ts
#   â€¢ src/api/webhooks/stripe/route.ts
#   â€¢ src/checkout/index.ts
#
# Dependencies to install:
#   â€¢ @stripe/stripe-js@2.0.0
#   â€¢ stripe@14.0.0
#
# Environment variables needed:
#   â€¢ STRIPE_SECRET_KEY*
#   â€¢ STRIPE_WEBHOOK_SECRET*
#   â€¢ NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY*
#
# ? Apply this solution? Yes
# âœ“ Solution applied successfully!
```

#### 5. Install Dependencies & Configure

```bash
# Install packages
npm install @stripe/stripe-js stripe

# Add to .env
echo "STRIPE_SECRET_KEY=sk_test_..." >> .env
echo "STRIPE_WEBHOOK_SECRET=whsec_..." >> .env
echo "NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_..." >> .env
```

You now have a fully working checkout flow in minutes instead of hours!

---

## Related Documentation

- [Getting Started](/docs/getting-started) - Initial setup
- [Configuration](/docs/configuration) - All config options
- [Pre-Commit Workflow](/docs/pre-commit-workflow) - Integration with git hooks
